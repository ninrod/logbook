* command line install
** BIOS
*** disable secure boot on bios
*** TPM error (6)
    - had to disable the security chip in the thinkpad BIOS
*** enable intel virtualization on thinkpad
** create USB bootable pendrive
*** In MacOS

#+BEGIN_SRC sh
# in macos
diskutil list
diskutil unmountDisk /dev/diskX
# notice the 'r' before 'disk' for raw mode which makes the transfer much faster:
dd bs=4M if=/path/to/archlinux.iso of=/dev/rdiskX status=progress && sync
# After completion, macOS may complain that "The disk you inserted was not readable by this computer".
# Select 'Ignore'. The USB device will be bootable.
#+END_SRC

** partitioning

- had to use gdisk to get a GPT/UEFI partition table
- used a / and a /boot and a swap partition
- the / had to be ext4 formated (mounted on /mnt)
- the /boot had to be vfat formated (mounted on /mnt/boot)

** reFind bootloader

 - had to manually edit the refind_linux.conf
 #+BEGIN_SRC sh
 "boot with std options" "root=/dev/nvme0n1p3 rw add_efi_memmap"
 #+END_SRC
* Great XKB hellish configuration
** a new hope: create options
   - blog [[https://realh.co.uk/wp/linux-keymap-hacking/][post]] looks promissing
   - SO [[https://unix.stackexchange.com/a/215062/155613][question]] also looks promising
   - SO [[https://unix.stackexchange.com/q/294286][question]] interesting links
   - [[https://www.charvolant.org/doug/xkb/html/node5.html][aqui]] you have a full keyboard layout displaying key codes
** resources
   - this arch linux specific [[https://wiki.archlinux.org/index.php/X_KeyBoard_extension][entry]] (arch wiki) (não explica quais arquivos você tem que criar)
   - see also [[https://wiki.archlinux.org/index.php/Keyboard_configuration_in_Xorg][this]] entry on arch wiki (keyboard configuration) (não explica quais arquivos você tem que criar)
   - see [[https://askubuntu.com/questions/325272/permanent-xmodmap-in-ubuntu-13-04/347382#347382?newreg=4eb097870a15490ebbe39d78412f9797][this]] SO answer (não ajudou)
   - and [[https://askubuntu.com/questions/684459/configure-caps-lock-as-altgr-and-arrows-like-in-vim/898462#898462][this]] (não ajudou)
   - and [[http://rlog.rgtti.com/2014/05/01/how-to-modify-a-keyboard-layout-in-linux/][this]] blog post by romano gianeti
   - and [[https://help.ubuntu.com/community/Custom%2520keyboard%2520layout%2520definitions?action=show&redirect=Howto%253A+Custom+keyboard+layout+definitions][this]] ubuntu tutorial
   - and [[https://ubuntuforums.org/showthread.php?t=1387812][this]] ubuntu blog post
   - and [[https://www.freedesktop.org/wiki/Software/XKeyboardConfig/][this]] entry on xdesktop site
   - um [[https://www.x.org/wiki/XKB/][monte]] de artigos sobre xkb
   - talvez [[https://unix.stackexchange.com/questions/318359/map-right-alt-to-ctrl-key][essa]] seja a solução para o alt
** step by step
*** system wide configuration
/usr/share/X11/xkb/symbols/
*** arquivos relevantes:
+ rules/evdev.lst
+ rules/evdev.xml
+ symbols/custom (maioria das customizações)
+ types/custom (não tem nada, só um boilerplate)
+ keycodes/custom (não tem nada, nada mesmo)
** fix alt_r -> contro_l e capslock -> esc
    altere essas linhas do /usr/share/X11/xkb/symbols/us, na seção =xkb_symbols "intl" {=
#+BEGIN_SRC sh
    //include "level3(ralt_switch)"
    include "ctrl(ralt_rctrl)"
    include "capslock(escape)"
#+END_SRC

- alternativamente, apenas crie um arquivo em  com o seguinte conteúdo e salve em /etc/X11/xorg.conf.d/90-custom-kbd.conf:
- mas não funciona para o alt. mesmo assim teria que descomentar a linha no us intl

#+BEGIN_SRC sh
Section "InputClass"
    Identifier "keyboard defaults"
    MatchIsKeyboard "on"
    Option "XKbOptions" "caps:escape"
EndSection
#+END_SRC


* keyboard
** fix lang
1. verify that you are not setting =$LANG= manually
2. uncomment pt_BR.UTF-8 in /etc/locale.gen
3. run =locale-gen=
4. certify that pt_BR is installed: run =localectl list-locales=
5. now install pt_BR: localectl set-locale LANG=pt_BR.UTF-8
6. reboot and login
** fix virtual console
   #+BEGIN_SRC sh
   echo "KEYMAP=us-acentos" > /etc/vconsole.conf
   #+END_SRC
** fix layout
*** fix layout

  - with help from [[https://wiki.archlinux.org/index.php/Keyboard_configuration_in_Xorg#Setting_keyboard_layout][arch wiki]]
  #+BEGIN_SRC sh
    localectl set-x11-keymap us pc104 intl
  #+END_SRC

*** fix cedilha in US-international with deadkeys
***** if using en_US.UTF-8 as lang

    - stolen from: [[https://gist.github.com/ninrod/a29a99a20e695ba1a2ce7e774803a501][here]]
    #+BEGIN_SRC txt
    Author: Nilo Dantas - n1lo
    Based on: https://bugs.launchpad.net/ubuntu/+source/ibus/+bug/518056 - helio-valente post

    How to use Cedilha on US Keyboard on ArchLinux

    1) Put: English(US, internacional with dead Keys) on your system keyboard layout.
    2) Editing the files:
    sudo vim /usr/lib/gtk-3.0/3.0.0/immodules.cache
    sudo vim /usr/lib/gtk-2.0/2.10.0/immodules.cache

    changing the line

    "cedilla" "Cedilla" "gtk20" "/usr/share/locale" "az:ca:co:fr:gv:oc:pt:sq:tr:wa"
    to
    "cedilla" "Cedilla" "gtk20" "/usr/share/locale" "az:ca:co:fr:gv:oc:pt:sq:tr:wa:en"

    3) replacing "ć" to "ç" and "Ć" to "Ç" on /usr/share/X11/locale/en_US.UTF-8/Compose

    sudo cp /usr/share/X11/locale/en_US.UTF-8/Compose /usr/share/X11/locale/en_US.UTF-8/Compose.bak
    sed 's/ć/ç/g' < /usr/share/X11/locale/en_US.UTF-8/Compose | sed 's/Ć/Ç/g' > Compose
    sudo mv Compose /usr/share/X11/locale/en_US.UTF-8/Compose

    4) add two lines on /etc/environment

    GTK_IM_MODULE=cedilla
    QT_IM_MODULE=cedilla

    5)restart your computer
    #+END_SRC
***** if using pt_BR.UTF-8 as lang
      - no need to do anything
* touchpad
  eu botei o seguinte arquivo em /etc/X11/xorg.conf.d/30-touchpad.conf
#+BEGIN_SRC sh
# configs de touchpad
Section "InputClass"
        Identifier "libinput touchpad catchall"
        MatchIsTouchpad "on"
        MatchDevicePath "/dev/input/event*"
        Driver "libinput"
	Option "Tapping" "on"
EndSection
#+END_SRC
* intel graphics card
  eu botei o seguinte arquivo em /etc/X11/xorg.conf.d/20-intel.conf
#+BEGIN_SRC sh
Section "Device"
	Identifier  "Intel Graphics"
	Driver      "intel"
	Option	    "DRI"	"false"
EndSection
#+END_SRC
* hosts file
  - [[https://www.reddit.com/r/archlinux/comments/6llvgv/chromium_taking_a_long_ass_time_to_load_up/djuuq0r/][fix hosts file]]
* wifi / networking
  - =netctl enable profile= to permanent add your profile
* pacaur
  - install from AUR.
* sudo without a password

- stolen from here: [[https://bbs.archlinux.org/viewtopic.php?id=7482][here]]
- edit /etc/pam.d/sudo and set the following as the 1st line to allow wheel group to use sudo with no password :
#+BEGIN_SRC sh
auth           sufficient      pam_wheel.so trust use_uid
#+END_SRC

* mount, umount, eject pendrives on the command line
  - install =udisksctl= and =udiskie= auto mount pendrives for you. install these
** info
   - see [[https://askubuntu.com/a/859798/685029][this]] SO answer
   - and [[https://unix.stackexchange.com/a/45821/155613][this]]
   - and also [[https://unix.stackexchange.com/a/178648/155613][this]]
   - udiskie already auto mounts pendrives for you.
** the simple way step
   1. identify the disk with =lsblk -fm=
   2. verify if the disk is already mounted with =df -h=
   3. umont with =sudo umount /mnt/sdn=, or =sudo umount /dev/sdxm=
** the professional way (udiskie)
   1. identify the disk with =lsblk -fm=
   2. verify if the disk is already mounted with =df -h=
   3. udisksctl =unmount -b /dev/sda1= (use this to just umount the drive)
   4. udisksctl =power-off -b /dev/sda=
* X
  - had to install xorg and xorg-xinit
* bspwm
  - pacman -S bspwm sxhkd dmenu
  - install pulse audio
  - pacaur -S xst-git
* audio
  - install pulse audio, alsa, etc...
  - install alsamixer
  - install pavucontrol and tweak settings and umute things
  - pavucontrol is actually the volume slider, as is alsamixer
* file manager
  - just use nautilus
* github
** generate ssh-key

- stolen from [[http://www.w3docs.com/snippets/git/how-to-generate-ssh-key-for-git.html][here]]
#+BEGIN_SRC sh
# generate key
ssh-keygen -t rsa -b 4096 -C "[your github's email]" # then enter, enter, enter

# start ssh-agent
eval "$(ssh-agent -s)"
> Agent pid 59566

# add key to ssh-agent
ssh-add ~/.ssh/id_rsa

# add key to github
cat .ssh/id_rsa.pub
#+END_SRC
* battery life
  - =pacman -S acpi; acpi -V=
  - tlp stat
* hdmi
** video
   - just use xrandr
   - =xrandr --output HDMI2 --auto=
** audio
   - just use pavucontrol
* infernal beep
  - taken from [[https://wiki.archlinux.org/index.php/PC_speaker][here]]
  #+BEGIN_SRC sh
    echo "blacklist pcspkr" > /etc/modprobe.d/nobeep.conf
  #+END_SRC
* screenshots

#+BEGIN_SRC sh
$ pacman -S maim
$ maim screenshot.png
$ maim -d 5 screenshot.png # pause for 5 seconds
$ maim -s shot.png # select an area, or window (just click on the window)
$ man maim # for more options
#+END_SRC
* screen locker
  - pacaur -S physlock
* pdf reader
  - zathura and evince
* video
  - mpv
* font management
** font/char viewer (fontawesome, nerdfonts, material icons, etc...)
   - tip from [[https://redd.it/6l3ivb][here]]
   - pacman -S =gucharmap=
** viewing available fonts
   - =$ fc-list=
* julicloud | wdmycloudx2 | nfs
  1. export the share as NFS
  2. showmount -e server
  3. nmap: =nmap -p 111 192.168.0.0/24=
  4. =sudo mount server:/path/of/the/mount /mnt/mountpoint=
* mpd + ncmpcpp
  - pacman -S mpd ncmpcpp
  - ncmpcpp [[https://wiki.archlinux.org/index.php/Ncmpcpp][arch wiki]]
  - mpd [[https://wiki.archlinux.org/index.php/Music_Player_Daemon][arch wiki]]
* gpg and pass
- [[https://superuser.com/questions/813421/can-you-extend-the-expiration-date-of-an-already-expired-gpg-key/814663#814663][extend the expiration date of an already expired key]]
* video recording
  - [[https://wiki.archlinux.org/%209.php/FFmpeg#Package_installation][ffmpeg]]
* caveats, pitfalls and traps
  - don't install =ibus=. If you do that, inkscape and visual studio code will not work, among other things.
  - do not use gtk_module=anything globally. It will fuck up many apps, including thunar, darktable and inkscape.
